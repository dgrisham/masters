\documentclass[12pt,letterpaper,]{article}


\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript

\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
    \usepackage{xltxtra,xunicode}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Mapping=tex-text,Scale=MatchLowercase}
  \newcommand{\euro}{â‚¬}


\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}


\ifxetex
  \usepackage[setpagesize=false, % page size defined by xetex
              unicode=false, % unicode breaks when used with xetex
              xetex]{hyperref}
\else
  \usepackage[unicode=true]{hyperref}
\fi
\hypersetup{breaklinks=true,
            bookmarks=true,
            pdfauthor={},
            pdftitle={Hey hey you you I don't like your ti-tle: An empirical study},
            colorlinks=true,
            citecolor=blue,
            urlcolor=blue,
            linkcolor=magenta,
            pdfborder={0 0 0}}
\urlstyle{same}  % don't use monospace font for urls
\usepackage[numbers,square]{natbib}
\bibliographystyle{IEEEtranN-nourl}


\usepackage{listings}





\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\graphicspath{ {./figures/} }



\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}


\title{Hey hey you you I don't like your ti-tle: An empirical study}

\author{true}

\date{}

% 'extends the array and column environments'
% \usepackage{array}

% for tables that span > 1 page
% \usepackage{longtable}

% rotate text/figures/tables/etc.
% \usepackage{rotating}

% for refs -- commented out in lhillber's
% \usepackage{natbib}

% hyper links
\usepackage{hyperref}

% for landscape pages (redundant w/ `rotating` ?)
% \usepackage{pdflscape}

% math typesetting; extends/fixes `amsmath`
\usepackage{mathtools}

% fonts (specifically math?)
%\usepackage{bbm}

% extended symbol fonts, part of `amsfonts`
%\usepackage{amssymb}

% rsfs font for math; `\mathscr` over `\mathcal`
%\usepackage{mathrsfs}

% syntax highlighting for code
\usepackage{listings}

% enables 'ragged' alignment; req'd for csm-thesis.sty?
\usepackage{ragged2e}

\usepackage{graphicx}

% extended control for captions
% `labelsep=quad` puts `\quad` space between e.g. "Figure 1" and caption text
\usepackage[labelsep=quad]{caption}

% format references

\usepackage{cleveref}
\crefformat{section}{\S#2#1#3}
\crefformat{subsection}{\S#2#1#3}
\crefformat{subsubsection}{\S#2#1#3}
\crefrangeformat{section}{\S\S#3#1#4 to~#5#2#6}
\crefmultiformat{section}{\S\S#2#1#3}{ and~#2#1#3}{, #2#1#3}{ and~#2#1#3}

\usepackage{csm-thesis}

\captionsetup[lstlisting]{font={stretch=1}}

\title{Game Theoretical Analysis of Resource Allocation in the InterPlanetary File System}

\degreetitle{Master of Science}
\discipline{Computer Science}
\department{Computer Science}

\author{David M. Grisham}
\advisor{Dejun Yang}
\dpthead{Tracy Camp}{Head}

% aliases

%% graphics

\newcommand{\graphicw}[2]{\center \includegraphics[width=#2]{#1}}
\newcommand{\graphicwc}[3]{\begin{figure}\center
    \includegraphics[width=#2]{#1}\caption{#3}\end{figure}}
\newcommand{\graphicwlc}[5]{\begin{figure}\center
    \includegraphics[width=#2]{#1}\caption[#4]{#5}\label{#3}\end{figure}}

%% math notation

\DeclarePairedDelimiter\abs{\lvert}{\rvert}
\newcommand{\Network}{\ensuremath{\mathcal{N}}}
\newcommand{\Nbhd}[1]{\ensuremath{\mathcal{N}_{#1}}}

% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

\begin{document}
\frontmatter

\maketitle
\newpage

\makecopyright{\the\year}
\newpage

\makesubmittal
\newpage

\begin{abstract}
Welcome to my paper!
\end{abstract}

\newpage



\hypersetup{linkcolor=black}
\setcounter{tocdepth}{2}
\tableofcontents

\listoffiguresandtables

%%
\bodymatter

% TODO: difference between bodymatter and body??
\hypertarget{introduction}{%
\chapter{Introduction}\label{introduction}}

The Internet is perhaps the largest and most consistent network that has
ever existed. Unfortunately, it predominantly runs on the outdated
hypermedia distribution protocol HTTP. The goal of the InterPlanetary
File System (IPFS) is to upgrade the Internet to a distributed
peer-to-peer system, thereby making it more robust and permanent. This
new Internet would be a network of peers, as opposed to clients and
servers, all sharing data between one another. In order for such a
system to thrive, users must be cooperative and willing to share data
with their peers. The goal of this project is to analyze the resource
allocation options of peers interacting in an IPFS network. A
combination of analytical and empirical methods will be used to glean
insights into the generally intractable allocation decisions that users
are presented with when participating in an IPFS network.

\hypertarget{ipfs}{%
\subsection{IPFS}\label{ipfs}}

IPFS is a peer-to-peer hypermedia distribution protocol developed by
Protocol Labs. It is a content-addressed, versioned filesystem. While a
variety of use cases exist for such a protocol, the most ambitious goal
of the project is to replace HTTP as the primary file exchange protocol
used in the Internet. This could ultimately result in the
decentralization of the Internet.

IPFS synthesizes various technologies developed since the Internet's
inception. These technologies include Git, BitTorrent, distributed hash
tables (e.g.~Kademlia), and self-certified filesystems. The IPFS stack
is shown in Figure \ref{img:ipfs-stack}. One way to conceptualize an
IPFS network is as a Git repository shared within a torrent-esque swarm.

\vspace{0.5cm}
\graphicwlc{../figures/ipfs_stack.png}{4in}{img:ipfs-stack}{The IPFS Stack}{{\bf The IPFS Stack}
-- Bitswap is at the exchange layer.}

\hypertarget{bitswap}{%
\subsection{Bitswap}\label{bitswap}}

Bitswap is the block exchange protocol of IPFS. The most direct
inspiration of this submodule is the BitTorrent peer-to-peer file
distribution protocol. Bitswap is the layer of IPFS that incentivizes
users to share data. A Bitswap \emph{reciprocation function} determines
which peers to send data to, and in what relative quantities. The input
to the reputation function is a set of metrics that may be used to weigh
peers -- e.g.~peer bandwidth, reputation, and/or location. The output is
a set of weights, one for each peer, that assign the relative resource
allocations for the peers. These weights are periodically recalculated
to reflect changes in both the network and peer behavior.

\hypertarget{objectives}{%
\subsection{Objectives}\label{objectives}}

\textbf{TODO: This section will likely need to be updated/replaced, as
it was copied directly from the proposal. At the very least, I think it
might need to be changed to be past-tense instead of future}

For this project, I will take the initial steps toward understanding the
behavior of users in an IPFS network as predicted by game theoretical
models. This will involve a combination of analytical and empirical
analyses, along with implementation of these ideas in the IPFS software.
The analytical work will focus on repeated games and, potentially,
evolutionary games, while the empirical work will take a
simulation-based approach. I intend to use these methods to classify
various Bitswap reciprocation functions and determine useful allocation
behavior under certain conditions.

\hypertarget{system-model}{%
\chapter{System Model}\label{system-model}}

This section details the model currently used to describe Bitswap in
this work. \cref{network-graph} models the IPFS network as a graph;
\cref{reputation} mathematically describes the peer-wise reputations and
user interactions; and \cref{game-formulation} formulates the problem as
a game.

\hypertarget{network-graph}{%
\subsection{Network Graph}\label{network-graph}}

We model an IPFS swarm as a network \Network~of \(\abs{\Network}\)
users. The graphical representation consists of

\begin{itemize}
\tightlist
\item
  \emph{nodes} representing users, and
\item
  \emph{unweighted, undirected edges}, each of which represents a
  peering between two users.
\end{itemize}

A user's \emph{neighborhood} is their set of peers, i.e.~the set of
nodes that the user is connected to by an edge. User \(i\)'s
neighborhood is denoted by \(\Nbhd{i}\), where
\(\Nbhd{i} \subseteq \Network\).

\hypertarget{reputation}{%
\subsection{Reputation}\label{reputation}}

We break Bitswap interactions into discrete rounds, with a single round
denoted by a nonnegative integer \(t\). The following two points
describe the way data distribution takes place in this Bitswap model.
Each of these points simplifies the problem from the real-world
scenario.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Each user \(j\) distributes exactly \(B_j\) bits, where \(B_j > 0\),
  to each of their peers in a given round (and has sufficient resources
  to do so).
\item
  All users always have unique data that all of their peers want. So,
  when a user allocates \(b\) bits to a particular peer, that user has
  at least \(b\) bits that the peer wants.
\end{enumerate}

We define \(b_{ij}^t\) as the total number of bits sent from user \(i\)
to peer \(j\) from round \(0\) to \(t-1\). User \(i\) maintains a
Bitswap \emph{ledger} \(l_{ij}^t\), for each of its peers
\(j \in \Nbhd{i}\), that stores the amount of data exchanged in both
directions, i.e. \(l_{ij}^t = (b_{ij}^t, b_{ji}^t)\).

Now we define the \emph{debt ratio} \(d_{ji}\) from user \(i\) to peer
\(j\) as

\[
d_{ji}^t = \frac{b_{ij}^{t-1}}{b_{ji}^{t-1}\:+\:1}
\]

\(d_{ji}^t\) can be thought of as peer \(i\)'s reputation from the
perspective of user \(j\). This reputation is then considered by user
\(j\)'s \emph{reputation function}
\(S_j(d_{ji}^t, \mathbf{d}_j^{-i,t}) \in \{0, 1\}\), where
\(\mathbf{d}_j^{-i,t} = (d_{jk}^t \mid \forall k \in \Nbhd{j}, k \neq i)\)
is the vector of debt ratios for all of user \(j\)'s peers in round
\(t\) \emph{excluding} peer \(i\). The reputation function considers the
relative reputation of peer \(i\) to the rest of \(j\)'s peers, and
returns a weight for peer \(i\). This weight is used to determine what
proportion of \(j\)'s resources to allocate to peer \(i\) in round
\(t\). This means that the following must hold:

\[
\sum_{i \in \Nbhd{j}} S_j(d_{ji}^t, \mathbf{d}_j^{-i,t}) = 1
\]

In other words, the sum of the weights that \(j\) assigns to its peers
must be \(1\) (otherwise, \(j\) would allocate more than its available
bandwidth to its peers).

Given all of this, we can calculate \(b_{ji}^{t+1}\) given \(b_{ji}^t\),
\(d_{ji}^t\), and \(\mathbf{d}_j^{-i,t}\):

\[
b_{ji}^{t+1} = b_{ji}^{t} + S_j(d_{ji}^t, \mathbf{d}_j^{-i,t}) \times B_j
\]

\hypertarget{game-formulation}{%
\subsection{Game Formulation}\label{game-formulation}}

The game model presented here is the product of multiple iterations that
approached a balance between the accuracy of the model to the problem
and model complexity. Previous modeling approaches included tools from
evolutionary game theory and statistical mechanics on the high
complexity end, and repeated games on the low accuracy end. While the
current model uses a repeated game model as well, the strategy space has
been modified to better fit the Bitswap scenario.\footnote{A description
  of the model from the previous iteration can be found at
  \url{https://github.com/dgrisham/masters/tree/master/deprecated/analysis}.}

All users in the network participate in the Bitswap game. The players in
this game are the users in the IPFS network, and each player's strategy
is the reciprocation function they choose to assign weights to their
peers. The strategy space, then, is the space containing all pure
functions of the form
\(S_j(d_{ji}^t, \mathbf{d}_j^{-i,t}) \in \{0, 1\}\). The Bitswap game is
an \emph{infinitely repeated}, \emph{incomplete information} game in
which users exchange data. One game takes place between each pair of
peers for each round \(t\). The \emph{players} are the IPFS users in the
network \Network. The utility of player \(i\) in round \(t\) is the sum
of all of the data that \(i\) is sent by its peers in that round:

\[
u_i^t = \sum_{j \in \Nbhd{i}} (b_{ji}^t - b_{ji}^{t-1})
\]

The total utility of a peer over the entire repeated game, then, can be
expressed in the following ways:

\begin{align*}
U_i &= \sum_{t=0}^{\infty} u_i^t \\
U_i &= \sum_{j \in \Nbhd{i}} b_{ji}^\infty
\end{align*}

The latter representation can be most directly thought of as the total
amount of data that peer \(i\) receives from all of its peers over the
entire duration of the Bitswap game.

                \bibliography{papers}

    

\end{document}
